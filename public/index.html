<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>McKFeelings Quiz</title>
  <style>
    body {
      font-family: 'Comic Sans MS', cursive, sans-serif;
      margin: 0;
      padding: 20px;
      max-width: 600px;
      margin: auto;
      background-color: #e0f7ff;
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      transition: background 1s ease;
    }
    .step { display: none; }
    .step.active { display: block; }
    h2 { margin-bottom: 10px; font-family: 'Comic Sans MS', cursive, sans-serif; }
    .slider-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 20px 0;
    }
    .slider-label { width: 120px; text-align: center; }
    input[type=range] {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      height: 6px;
      background: #ddd;
      border-radius: 3px;
      outline: none;
      margin: 0 10px;
    }
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 16px;
      height: 16px;
      background: #4CAF50;
      border-radius: 50%;
      cursor: pointer;
    }
    button {
      font-family: 'Comic Sans MS', cursive, sans-serif;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      border-radius: 12px;
  background: url("Cloud.png") no-repeat center center;
  background-size: contain;
  border: none;
  color: #000;
  font-weight: bold;
  font-size: 1rem;
  padding: 30px 60px;
  cursor: pointer;
  text-align: center;
  text-shadow: 0 0 2px #fff;
  mix-blend-mode: luminosity;
  transition: filter 0.3s ease;
  filter: brightness(1.1) contrast(1.1);
}
    #output {
      margin-top: 30px;
      padding: 20px;
      background: #fff;
      border-radius: 8px;
      text-align: center;
    }
    #share {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    textarea {
      font-family: 'Comic Sans MS', cursive, sans-serif;
      width: 100%;
      height: 80px;
      margin-top: 10px;
    }
      @media (max-width: 480px) {
    .slider-row {
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }
    .slider-label {
      width: auto;
      font-size: 0.9rem;
    }
      body {
        padding: 10px;
      }
      button {
        padding: 20px 40px;
        font-size: 0.9rem;
      }
      h1 {
        font-size: 1.5rem;
      }
    }
    .progress-bar {
      width: 100%;
      height: 10px;
      background-color: #eee;
      border-radius: 5px;
      overflow: hidden;
      margin: 10px 0;
    }
    .progress-fill {
      height: 100%;
      background-color: #4CAF50;
      width: 0%;
      transition: width 0.3s ease;
    }
    .result-card {
      border: 1px solid #ddd;
      border-radius: 12px;
      background: #fefefe;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
  .slider-value {
      text-align: center;
      font-size: 0.9rem;
      color: #333;
      margin-top: -10px;
      margin-bottom: 10px;
    }
    .fade-in {
      animation: fadeIn 0.6s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    button:hover {
      transform: scale(1.05);
      filter: brightness(1.15);
    }
    .step-count {
      text-align: center;
      font-size: 0.95rem;
      color: #222;
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  <h1 style="text-align: center; font-family: 'Comic Sans MS', cursive, sans-serif; font-size: 1.4rem; margin-top: 10px; margin-bottom: 5px; text-shadow: 1px 1px 2px #fff;">What are you McKFeeling like today?</h1>
  <div id="intro" class="step active">
    <h2>Emotion Identifier Quiz</h2>
    <p>This quiz helps you pinpoint your current feeling by guiding you through slider-based questions drawn from therapeutic techniques.</p>
    <button onclick="startQuiz()">Start Quiz</button><br><button onclick="location.reload()" style="margin-top: 10px; font-size: 0.8rem; padding: 10px 20px;">‚Üê Restart</button>
  </div>

  <div id="quiz-container" class="step">
    <div id="question" class="fade-in">
      <div class="progress-bar"><div class="progress-fill" id="progress-bar"></div></div>
      <div class="step-count" id="step-count"></div>
      <h2 id="question-text"></h2>
      <div class="slider-row" style="flex-wrap: wrap; gap: 10px; justify-content: space-between; align-items: center;">
  <span class="slider-label" id="left-label">Unpleasant</span>
  <input id="slider" type="range" min="1" max="5" step="1" value="3" aria-label="How strongly do you feel on this scale?" style="flex-grow: 1; margin: 0 10px;" />
  <span class="slider-label" id="right-label">Pleasant</span>
</div>
<div class="slider-value" id="slider-value">You chose: Neutral</div>
      <button onclick="nextQuestion()">Next</button>
    </div>
    <div id="output" class="step" style="display: none;"></div>
    <div id="share" class="step" style="display: none;">
      <h3>Share or Save Your Result</h3>
      <textarea id="summary" readonly></textarea>
      <button onclick="copySummary()">Copy to Clipboard</button>
    </div>
  </div>

  <script>
    function startQuiz() {
      document.getElementById("intro").classList.remove("active");
      document.getElementById("quiz-container").classList.add("active");
      document.getElementById("question").classList.add("fade-in");
  document.getElementById("step-count").textContent = getStepLabel(currentId);
  updateProgress(currentId);
  loadQuestion(questionBank[currentId]);
    }

    const questionBank = {
      q1: {
        id: "q1",
        text: "Thinking about how you feel right now, how pleasant or unpleasant is your current experience?",
        left: "Unpleasant",
        right: "Pleasant",
        next: (val) => val <= 2 ? "q2_low" : val >= 4 ? "q2_high" : "q2_mid"
      },
      q2_low: {
        id: "q2_low",
        text: "In this moment, does your low energy feel more like tiredness or sadness?",
        left: "Tired",
        right: "Sad",
        next: () => "q3"
      },
      q2_mid: {
        id: "q2_mid",
        text: "As you reflect on today, are you feeling more grounded or more scattered in focus?",
        left: "Stable",
        right: "Distracted",
        next: () => "q3"
      },
      q2_high: {
        id: "q2_high",
        text: "When you think about your current good mood, does it feel more joyful or more excited?",
        left: "Joyful",
        right: "Excited",
        next: () => "q3"
      },
      q3: {
        id: "q3",
        text: "Right now, how energized or activated do you feel in your body and mind?",
        left: "Deactivated",
        right: "Activated",
        next: () => null
      }
    };

    let currentId = "q1";
    const answers = [];

    function loadQuestion(q) {
  const qEl = document.getElementById("question");
  qEl.classList.remove("fade-in");
  void qEl.offsetWidth;
  qEl.classList.add("fade-in");
  document.getElementById("question-text").textContent = q.text;
  document.getElementById("left-label").textContent = q.left;
  document.getElementById("right-label").textContent = q.right;
  document.getElementById("slider").value = 3;
  document.getElementById("slider-value").textContent = "You chose: Neutral";
  document.getElementById("question").classList.add("fade-in");

  const buttonTintByQuestion = {
    q1: "hue-rotate(180deg)",
    q2_low: "hue-rotate(0deg) brightness(1.1)",
    q2_mid: "hue-rotate(60deg)",
    q2_high: "hue-rotate(90deg)",
    q3: "hue-rotate(240deg)"
  };

  const buttons = document.querySelectorAll("button");
  buttons.forEach(btn => {
    btn.style.filter = buttonTintByQuestion[q.id] || "none";
  });
}

    function nextQuestion() {
  document.getElementById("step-count").textContent = getStepLabel(currentId);
  document.getElementById("question").classList.remove("fade-in");
      const sliderValue = +document.getElementById("slider").value;
      const labelMap = ["Very left", "Left", "Neutral", "Right", "Very right"];
      document.getElementById("slider-value").textContent = `You chose: ${labelMap[sliderValue - 1]}`;
      const current = questionBank[currentId];
      answers.push({ prompt: current.text, value: sliderValue });
      const nextId = typeof current.next === "function" ? current.next(sliderValue) : null;

      if (nextId && questionBank[nextId]) {
        currentId = nextId;
        loadQuestion(questionBank[currentId]);
      } else {
        showResults();
      }
    }

    async function showResults() {
  document.getElementById("question").classList.remove("active");
  const res = await fetch("/api/analyze", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ questions: answers })
  });
  const data = await res.json();
  const emotion = data.emotion || "calm";
  const definition = data.definition || "You feel steady and relaxed.";
  const synonyms = Array.isArray(data.synonyms) ? data.synonyms.join(", ") : "still, balanced, content";
  const resultText = `Emotion: ${emotion}
Definition: ${definition}
Synonyms: ${synonyms}`;
  const emojiMap = {
    calm: "üßò",
    anxious: "üò∞",
    excited: "üòÑ",
    sad: "üò¢",
    angry: "üò†",
    numb: "üò∂",
    content: "üòä",
    happy: "üòÉ",
    reflective: "ü™û",
    bored: "üòê",
    hopeful: "üå§Ô∏è",
    discouraged: "üòû"
  };
  const emoji = emojiMap[emotion] || "üôÇ";
  document.getElementById("output").innerHTML = `
  <div class="result-card">
    <h2>Your Emotional Snapshot</h2>
    <p><strong>Emotion:</strong> ${emoji} ${emotion}</p>
    <p><strong>Definition:</strong> ${definition}</p>
    <p><strong>Synonyms:</strong> ${synonyms}</p>
    <p><em>${getEmotionInsight(emotion)}</em></p>
    <button onclick="location.reload()" style="margin-top: 20px;">Try Again</button>
  </div>`;
  document.getElementById("summary").value = resultText;
  document.getElementById("output").style.display = "block";
  document.getElementById("share").style.display = "flex";

  // Set button tint based on emotion
  const buttons = document.querySelectorAll("button");
  const tintMap = {
    calm: "hue-rotate(180deg)",
    anxious: "hue-rotate(0deg) brightness(1.1)",
    excited: "hue-rotate(60deg)",
    sad: "hue-rotate(220deg)",
    angry: "hue-rotate(330deg) brightness(1.2)"
  };
  buttons.forEach(btn => {
    btn.style.filter = tintMap[emotion] || "none";
  });
    }

    function getEmotionInsight(emotion) {
  const insights = {
    calm: "Calm often means your body feels safe and your environment feels predictable.",
    anxious: "Anxiety can signal uncertainty or unmet needs for safety or clarity.",
    excited: "Excitement often arises when you're anticipating something joyful or novel.",
    sad: "Sadness may appear when something important feels lost or missing.",
    angry: "Anger often reflects a boundary crossed or a need for justice.",
    numb: "Numbness can be your mind's way of shielding from overwhelm.",
    content: "Contentment comes from having your basic emotional needs met.",
    happy: "Happiness can reflect alignment between your actions and values.",
    reflective: "Reflectiveness shows openness to insight and inner exploration.",
    bored: "Boredom might mean your curiosity or engagement needs attention.",
    hopeful: "Hope points to possibility and belief in change.",
    discouraged: "Discouragement may show up when effort isn't met with progress."
  };
  return insights[emotion] || "Your emotion gives clues about what matters to you.";
}

function copySummary() {
      const textarea = document.getElementById("summary");
      textarea.select();
      textarea.setSelectionRange(0, 99999);
      document.execCommand("copy");
      alert("Copied to clipboard!");
    }
  function getStepLabel(id) {
  const map = {
    q1: "Step 1 of 3",
    q2_low: "Step 2 of 3",
    q2_mid: "Step 2 of 3",
    q2_high: "Step 2 of 3",
    q3: "Step 3 of 3"
  };
  return map[id] || "";
}
function updateProgress(id) {
  const map = {
    q1: 33,
    q2_low: 66,
    q2_mid: 66,
    q2_high: 66,
    q3: 100
  };
  const pct = map[id] || 0;
  document.getElementById("progress-bar").style.width = pct + "%";
}
</script>
</body>
</html>
